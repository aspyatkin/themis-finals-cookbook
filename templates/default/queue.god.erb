(0...<%= node['themis-finals']['queue']['processes'] %>).to_a.each do |num|
  God.watch do |w|
    w.group = 'queues'
    w.name = "queue-#{num}"
    w.dir = '<%= node['themis-finals']['basedir'] %>'
    w.uid = '<%= node['themis-finals']['user'] %>'
    w.gid = '<%= node['themis-finals']['group'] %>'
    w.log = "<%= node['themis-finals']['basedir'] %>/logs/queue-#{num}.log"
    w.start = 'bundle exec ruby queue.rb'
    w.env = {
      'LOG_LEVEL' => '<%= node['themis-finals']['log_level'] %>',
      'STDOUT_SYNC' => '<%= node['themis-finals']['stdout_sync'] %>'
    }
    w.keepalive
    w.stop_signal = 'INT'
  end
end
