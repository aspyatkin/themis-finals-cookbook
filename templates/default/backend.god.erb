(0...<%= @processes %>).to_a.each do |num|
  God.watch do |w|
    w.group = 'backends'
    w.name = "backend-#{num}"
    w.dir = '<%= @basedir %>'
    w.uid = '<%= @user %>'
    w.gid = '<%= @group %>'
    w.log = "<%= @basedir %>/logs/backend-#{num}.log"
    w.start = 'bundle exec ruby backend.rb'
    w.keepalive
    w.env = {
      'PORT' => "#{3000 + num}",
      'LOG_LEVEL' => '<%= @log_level %>',
      'STDOUT_SYNC' => '<%= @stdout_sync %>',
      <% if @production %>
      'RACK_ENV' => 'production'
      <% else %>
      'RACK_ENV' => 'development'
      <% end %>
    }
  end
end
